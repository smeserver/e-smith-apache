diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassBrand mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassBrand
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassBrand	2005-07-17 14:36:10.287031808 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassBrand	1969-12-31 17:00:00.000000000 -0700
@@ -1,14 +0,0 @@
-{
-# ProxyPass executes a module which relays requests to another server
-# We use it to allow transparent access to the admin instance of the
-# web server.
-}
-
-ProxyPass /server-brand http://127.0.0.1:980/server-brand/
-<Location /server-brand>
-    order deny,allow
-    deny from all
-{
-    $OUT .= "    allow from $localAccess\n";
-}
-</Location>
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassCommon mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassCommon
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassCommon	2005-07-17 14:36:10.290031352 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassCommon	1969-12-31 17:00:00.000000000 -0700
@@ -1,12 +0,0 @@
-{
-# ProxyPass executes a module which relays requests to another server
-# We use it to allow transparent access to the admin instance of the
-# web server.
-}
-
-ProxyPass /server-common http://127.0.0.1:980/server-common/
-<Location /server-common>
-    order deny,allow
-    deny from all
-    allow from all
-</Location>
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassManager mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassManager
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassManager	2005-07-17 14:36:10.292031048 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassManager	1969-12-31 17:00:00.000000000 -0700
@@ -1,14 +0,0 @@
-{
-# ProxyPass executes a module which relays requests to another server
-# We use it to allow transparent access to the admin instance of the
-# web server.
-}
-
-ProxyPass /server-manager http://127.0.0.1:980/server-manager/
-<Location /server-manager>
-    order deny,allow
-    deny from all
-{
-    $OUT .= "    allow from $localAccess\n";
-}
-</Location>
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassPassword mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassPassword
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassPassword	2005-07-17 14:36:10.295030592 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/92ProxyPassPassword	1969-12-31 17:00:00.000000000 -0700
@@ -1,15 +0,0 @@
-{
-# ProxyPass executes a module which relays requests to another server
-# We use it to allow transparent access to the admin instance of the
-# web server.
-}
-
-ProxyPass /user-password http://127.0.0.1:980/user-password/
-<Location /user-password>
-    order deny,allow
-    deny from all
-{
-    $OUT .= "    allow from $localAccess\n";
-}
-</Location>
-
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias	2003-07-02 13:47:24.000000000 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias	2005-07-17 12:45:47.993307280 -0600
@@ -1 +1 @@
-    ServerAlias { "$virtualHost  $SystemName.$virtualHost" }
+    ServerAlias { "$virtualHost $SystemName.$virtualHost www.$virtualHost" }
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/27ManagerProxyPass mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/27ManagerProxyPass
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/27ManagerProxyPass	2005-07-17 14:36:10.299029984 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/27ManagerProxyPass	2005-07-17 14:16:15.610502704 -0600
@@ -1,79 +1,32 @@
 {
     # vim: ft=perl:
 
-    $OUT = "";
-    # Send any unencrypted attempts to the ssl port.
-    if (($port eq "80") && (${'httpd-admin'}{PermitPlainTextAccess} eq 'no'))
-    {
-        $OUT .= <<'HERE';
+    $haveSSL = (exists ${modSSL}{status} and ${modSSL}{status} eq "enabled") ?  'yes' : 'no';
+    $plainTextAccess = ${'httpd-admin'}{PermitPlainTextAccess} || 'no';
+
+    $OUT = <<'HERE';
     RewriteEngine on
 
-    RewriteCond %{REMOTE_ADDR} !=127.0.0.1
-    RewriteRule ^/server-manager   https://%{HTTP_HOST}/server-manager [L,R]
-    RewriteCond %{REMOTE_ADDR} !=127.0.0.1
-    RewriteRule ^/server-brand     https://%{HTTP_HOST}/server-brand [L,R]
-    RewriteCond %{REMOTE_ADDR} !=127.0.0.1
-    RewriteRule ^/e-smith-manager  https://%{HTTP_HOST}/server-manager [L,R]
-    RewriteCond %{REMOTE_ADDR} !=127.0.0.1
-    RewriteRule ^/user-password    https://%{HTTP_HOST}/user-password [L,R]
-    RewriteCond %{REMOTE_ADDR} !=127.0.0.1
-    RewriteRule ^/e-smith-password https://%{HTTP_HOST}/user-password [L,R]
 HERE
-    }
-    return "    # skipping ProxyPass directives\n" unless $port eq "443"; 
-
-    return "# modSSL disabled" 
-        unless (exists ${modSSL}{status} and ${modSSL}{status} eq "enabled");
-
-    #------------------------------------------------------------
-    # Proxy Pass directives.
-    # The global namespace/directives only cover HTTP based URLs
-    # so ProxyPass directives need to be defined inside each
-    # SSL enabled VirtualHost directive to allow external SSL
-    # access to be ProxyPass'd.
-    #------------------------------------------------------------
-
-    $OUT .= << "HERE";
-
-    # ProxyPass executes a module which relays requests to another server
-    # We use it to allow transparent access to the admin instance of the
-    # web server.
-
-    ProxyPass /server-brand http://127.0.0.1:980/server-brand/
-    <Location /server-brand>
-        order deny,allow
-        deny from all
-        allow from $localAccess $externalSSLAccess
-    </Location>
 
-    # ProxyPass executes a module which relays requests to another server
-    # We use it to allow transparent access to the admin instance of the
-    # web server.
-
-    ProxyPass /server-common http://127.0.0.1:980/server-common/
-    <Location /server-common>
-        order deny,allow
-        deny from all
-        allow from $localAccess $externalSSLAccess
-    </Location>
-
-    ProxyPass /server-manager http://127.0.0.1:980/server-manager/
-    <Location /server-manager>
-        order deny,allow
-        deny from all
-        allow from $localAccess $externalSSLAccess
-    </Location>
-
-    # ProxyPass executes a module which relays requests to another server
-    # We use it to allow transparent access to the admin instance of the
-    # web server.
-
-    ProxyPass /user-password http://127.0.0.1:980/user-password/
-    <Location /user-password>
-        order deny,allow
-        deny from all
-        allow from $localAccess $externalSSLAccess
-    </Location>
-
-HERE
+    foreach $place ('server-manager','server-common','user-password')
+    {
+        if (($port eq "80") && ($haveSSL eq 'yes') && ($plainTextAccess ne 'yes'))
+        {
+            $OUT .= "    RewriteRule ^/$place    https://%{HTTP_HOST}/$place [L,R]\n";
+        } else {
+            $OUT .= "    ProxyPass /$place http://127.0.0.1:980/$place/\n";
+        }
+
+        $OUT .= "    <Location /$place>\n";
+        $OUT .= "        order deny,allow\n";
+        $OUT .= "        deny from all\n";
+        if (($haveSSL eq 'yes') && (($port eq "443") || ($plainTextAccess ne 'yes')))
+        {
+            $OUT .= "        allow from $localAccess $externalSSLAccess\n";
+        } else {
+            $OUT .= "        allow from $localAccess\n";
+        }
+        $OUT .= "    </Location>\n";
+    }
 }
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias	2003-01-07 08:00:49.000000000 -0700
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias	2005-07-17 12:39:18.110796600 -0600
@@ -1,8 +1,3 @@
-{
-    $OUT .= "\n";
-    $OUT .= "    # alias for Apache icons\n";
-    $OUT .= "\n";
-    $OUT .= "    Alias /icons/ /var/www/icons/\n";
-    $OUT .= "\n";
-    $OUT;
-}
+    # alias for Apache icons\n";
+    Alias /icons/ /var/www/icons/\n";
+
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ServerResources mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ServerResources
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ServerResources	2003-01-07 08:00:49.000000000 -0700
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ServerResources	2005-07-17 12:39:21.552273416 -0600
@@ -1,4 +1,3 @@
-# Alias for server resources
-
-Alias /server-resources/ /home/e-smith/files/server-resources/
+    # Alias for server resources
+    Alias /server-resources/ /home/e-smith/files/server-resources/
 

Index: e-smith-apache/createlinks
diff -u e-smith-apache/createlinks:1.15 e-smith-apache/createlinks:1.16
--- e-smith-apache/createlinks:1.15	Fri Jun 17 11:43:58 2005
+++ e-smith-apache/createlinks	Tue Aug  9 11:59:04 2005
@@ -46,6 +46,33 @@
 safe_symlink("sigusr1", "root/etc/e-smith/events/$event/services2adjust/httpd-e-smith");
 
 #--------------------------------------------------
+# actions for host-create event
+#--------------------------------------------------
+
+$event = "host-create";
+
+templates2events("/etc/httpd/conf/httpd.conf", $event);
+safe_symlink("sigusr1", "root/etc/e-smith/events/$event/services2adjust/httpd-e-smith");
+
+#--------------------------------------------------
+# actions for host-delete event
+#--------------------------------------------------
+
+$event = "host-delete";
+
+templates2events("/etc/httpd/conf/httpd.conf", $event);
+safe_symlink("sigusr1", "root/etc/e-smith/events/$event/services2adjust/httpd-e-smith");
+
+#--------------------------------------------------
+# actions for host-modify event
+#--------------------------------------------------
+
+$event = "host-modify";
+
+templates2events("/etc/httpd/conf/httpd.conf", $event);
+safe_symlink("sigusr1", "root/etc/e-smith/events/$event/services2adjust/httpd-e-smith");
+
+#--------------------------------------------------
 # actions for ibay-create event
 #--------------------------------------------------
 
Index: e-smith-apache/e-smith-apache.spec
diff -u /dev/null e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/90e-smithAccess10icons:1.1
--- /dev/null	Tue Aug  9 11:59:56 2005
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/90e-smithAccess10icons	Tue Aug  9 11:59:04 2005
@@ -0,0 +1,12 @@
+#------------------------------------------------------------
+# icons directory
+#------------------------------------------------------------
+
+<Directory /var/www/icons>
+    Options Indexes
+    AllowOverride None
+    order deny,allow
+    deny from all
+    allow from all
+</Directory>
+
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/00Setup
diff -u /dev/null e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/00Setup:1.1
--- /dev/null	Tue Aug  9 11:59:56 2005
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/00Setup	Tue Aug  9 11:59:04 2005
@@ -0,0 +1,9 @@
+{
+    use esmith::DomainsDB;
+    # Convert the passed hash for the domain object back into an object.
+    $domain = bless \%domain, 'esmith::DB::db::Record';
+
+    # Make scalars from some of the properties of the domain
+    $virtualHost = $domain->key;
+    $OUT = "";
+}
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/02ServerName
diff -u e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/02ServerName:1.1 e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/02ServerName:1.2
--- e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/02ServerName:1.1	Fri May 27 15:48:12 2005
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/02ServerName	Tue Aug  9 11:59:04 2005
@@ -1 +1 @@
-    ServerName www.{$virtualHost}
+    ServerName {$virtualHost}
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias
diff -u e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias:1.1 e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias:1.2
--- e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias:1.1	Fri May 27 15:48:12 2005
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias	Tue Aug  9 11:59:04 2005
@@ -1 +1,8 @@
-    ServerAlias { "$virtualHost  $SystemName.$virtualHost" }
+    ServerAlias {
+
+    use esmith::HostsDB;
+    my $hdb = esmith::HostsDB->open_ro();
+    my @hosts = grep { $_->prop('HostType') eq 'Self' } $hdb->get_hosts_by_domain($virtualHost);
+    $OUT = join " ", map { $_->key } @hosts;
+}
+
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/02ServerName
diff -u e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/02ServerName:1.1.1.1 e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/02ServerName:1.2
--- e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/02ServerName:1.1.1.1	Tue Jan  7 10:00:49 2003
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/02ServerName	Tue Aug  9 11:59:04 2005
@@ -1 +1 @@
-    ServerName www.{$virtualHost}
+    ServerName {$virtualHost}
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias
diff -u e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias:1.2 e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias:1.3
--- e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias:1.2	Wed Jul  2 15:47:24 2003
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias	Tue Aug  9 11:59:04 2005
@@ -1 +1,8 @@
-    ServerAlias { "$virtualHost  $SystemName.$virtualHost" }
+    ServerAlias {
+
+    use esmith::HostsDB;
+    my $hdb = esmith::HostsDB->open_ro();
+    my @hosts = grep { $_->prop('HostType') eq 'Self' } $hdb->get_hosts_by_domain($virtualHost);
+    $OUT = join " ", map { $_->key } @hosts;
+}
+
Index: e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias
diff -u e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias:1.2 e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias:1.3
--- e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias:1.2	Mon Jul 18 15:51:39 2005
+++ e-smith-apache/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/40ApacheIconAlias	Tue Aug  9 11:59:04 2005
@@ -1,3 +1,3 @@
-    # alias for Apache icons\n";
-    Alias /icons/ /var/www/icons/\n";
+    # alias for Apache icons
+    Alias /icons/ /var/www/icons/
 

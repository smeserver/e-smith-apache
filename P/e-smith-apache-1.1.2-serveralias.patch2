diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias	2005-07-19 00:28:57.594465248 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/ProxyPassVirtualHosts/03ServerAlias	2005-07-19 00:28:52.758200472 -0600
@@ -2,10 +2,6 @@
 
     use esmith::HostsDB;
     my $hdb = esmith::HostsDB->open_ro();
-
-    my @localdomains = map { $_->key => 1 } $hdb->get_all_by_prop( HostType => 'Self' );
-    my @thisdomain = grep /\.$virtualHost$/, @localdomains;
-
-    $OUT = join " ", @thisdomain;
+    $OUT = join " ", map { $_->key } $hdb->get_hosts_by_domain($virtualHost)
 }
 
diff -Nur -x '*.orig' -x '*.rej' e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias
--- e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias	2005-07-19 00:28:57.602464032 -0600
+++ mezzanine_patched_e-smith-apache-1.1.2/root/etc/e-smith/templates/etc/httpd/conf/httpd.conf/VirtualHosts/03ServerAlias	2005-07-19 00:27:58.612664544 -0600
@@ -2,10 +2,6 @@
 
     use esmith::HostsDB;
     my $hdb = esmith::HostsDB->open_ro();
-
-    my @localdomains = map { $_->key => 1 } $hdb->get_all_by_prop( HostType => 'Self' );
-    my @thisdomain = grep /\.$virtualHost$/, @localdomains;
-
-    $OUT = join " ", @thisdomain;
+    $OUT = join " ", map { $_->key } $hdb->get_hosts_by_domain($virtualHost)
 }
 
